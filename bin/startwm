#!/bin/zsh

LOG_FILTER_CMD="grep --line-buffered -v -E '\
ould not resolve keysym|\
your system is too slow|\
ouch jump detected and discarded|\
nknown libinput event\
'"

case "${1}" in
	"sway")
		if [ "$(whence river)" ]; then
			exec sway -V \
				> >(eval "${LOG_FILTER_CMD}" > "/tmp/sway.${XDG_VTNR}.${USER}.log") 2>&1
		fi
		;;
	"river")
		if [ "$(whence river)" ]; then
			exec river \
				> >(eval "${LOG_FILTER_CMD}" > "/tmp/river.${XDG_VTNR}.${USER}.log") 2>&1
		fi
		;;
	"hyprland")
		if [ "$(whence Hyprland)" ]; then
			exec Hyprland > "/tmp/hyprland.${XDG_VTNR}.${USER}.log" 2>&1
		fi
		;;
	"x")
		if [ "$(whence startx)" ]; then
			export X_WM="${2}"
			exec startx \
				> >(eval "${LOG_FILTER_CMD}" > "/tmp/${X_WM}.x.${XDG_VTNR}.${USER}.log") 2>&1
		fi
		;;
	*)
		print "unknown wm ${1}" 1>&2
		;;
esac

