#!/bin/zsh

default="base16-default-dark"

base="${HOME}/.config/alacritty"

if [ "${1}" = "--theme" ]; then
	theme="${2}"
	shift
	shift
elif [ "$(( $RANDOM % 2 ))" -eq 1 ]; then
	theme="${default}"
elif [ -f /tmp/alac.session.random.theme ]; then
	read theme < /tmp/alac.session.random.theme
else
	themes=()
	for f in $(ls "${base}/themes"); do
		theme="${$(basename ${f})/.yml/}"
		if [ "${theme}" != "${default}" ]; then
			themes+="${theme}"
		fi
	done
	theme="${themes[$(( ( $RANDOM % ${#themes} ) + 1 ))]}"
	printf "%s" "${theme}" > /tmp/alac.session.random.theme
fi

cfg="/tmp/alacritty.${theme}.yml"

cat "${base}/alacritty.yml" "${base}/themes/${theme}.yml" | \
	grep -v "draw_bold_text_with_bright_colors" \
	> "${cfg}"

TMUX= \
	TERMINAL_THEME="${theme}" \
	/usr/bin/alacritty \
	--config-file="${cfg}" \
	"$@" \
	&

