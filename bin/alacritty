#!/bin/zsh

awesome=(
	"bloodmoon"
	"cobalt2"
	"itermdefault"
	"irblack"
)

banned=(
	# colours indistinguishable from background
	"material"
	"tango"
	"tangoish"
	"darktooth"
	"sourcerer"

	# ugly
	"ubuntu"

	# washed out
	"nova"

	# light
	"gruvboxlight"
	"onelight"
	"pencillight"
	"seagull"
	"solarizedlight"
	"terminalappbasic"
)

light=(
	"gruvboxlight"
	"onelight"
	"pencillight"
	"seagull"
	"solarizedlight"
	"terminalappbasic"
)

base="${HOME}/.config/alacritty"

if [ "${1}" = "--theme" -o "${1}" = "-t" ]; then
	theme="${2}"
	shift
	shift
else
	themes=()
	for f in "${base}/themes/"*yml; do
		theme="${$(basename ${f})/.yml/}"
		if [ -z "${banned[(re)${theme}]}" ]; then
			themes+=${theme}
		fi
	done
	theme="${themes[$(( ( $RANDOM % ${#themes} ) + 1 ))]}"
fi

if [ -n "${light[(re)${theme}]}" ]; then
	background="light"
else
	background="dark"
fi

cfg="/tmp/alacritty.${theme}.yml"

cat "${base}/alacritty.yml" "${base}/themes/${theme}.yml" \
	> "${cfg}"

TMUX= \
TERMINAL_THEME="${theme}" \
TERMINAL_BACKGROUND="${background}" \
	/usr/bin/alacritty \
	--config-file="${cfg}" \
	"$@" \
	&

