#!/bin/zsh

base="${HOME}/.config/alacritty"

themes=()
for f in $(ls "${base}/themes"); do
	theme="${$(basename ${f})/.yml/}"
	if [ -z "${banned[(re)${theme}]}" ]; then
		themes+=${theme}
	fi
done

if [ "${1}" = "--theme" ]; then
	theme="${2}"
	shift
	shift
else
	if [ -f /tmp/alac.last.theme ]; then
		read i < /tmp/alac.last.theme
	else
		i=1
	fi
	theme="${themes[${i}]}"
	if [ -z "${theme}" ]; then
		i=1
		theme="${themes[${i}]}"
	fi
	i=$i+1
	printf "%d" ${i} > /tmp/alac.last.theme
fi

cfg="/tmp/alacritty.${theme}.yml"

cat "${base}/alacritty.yml" "${base}/themes/${theme}.yml" "${base}/indexed-green.yml" | \
	grep -v "draw_bold_text_with_bright_colors" \
	> "${cfg}"

TMUX= \
	TERMINAL_THEME="${theme}" \
	/usr/bin/alacritty \
	--config-file="${cfg}" \
	"$@" \
	&

