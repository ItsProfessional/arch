#!/bin/sh

# Toggle sound for Tenveo webcam.
# Toggling the entire hub is unreliable: pulse doesn't always reconnect.

device_id()
{
	grep -l "${1}" /sys/bus/usb/devices/*/uevent | sort | tail -1 | sed -e 's#^/sys/bus/usb/devices/## ; s#/uevent$##'
}

is_bound()
{
	if [ -d "/sys/bus/usb/drivers/usb/${1}" ]; then
		echo "true"
	else
		echo "false"
	fi
}

device_off()
{
	if [ -d "/sys/bus/usb/devices/${1}" ]; then
		echo "${1}" > /sys/bus/usb/drivers/usb/unbind
	fi
}

device_on()
{
	if [ -d "/sys/bus/usb/devices/${1}" ]; then
		echo "${1}" > /sys/bus/usb/drivers/usb/bind
	fi
}

# Anhui LISTENAI CO.,LTD. Castor
ID_SOUND="$(device_id '27c2/526')"
BOUND_SOUND="$(is_bound ${ID_SOUND})"

if [ -z "${ID_SOUND}" ]; then
	echo "devices unavailable"
	exit
fi

if [ "${BOUND_SOUND}" = "true" ]; then
	echo unbinding
	device_off "${ID_SOUND}"
else
	echo binding
	device_on "${ID_SOUND}"
fi

