#!/bin/sh

# We use a shell script instead of .nvidia-settings-rc as that method will not assighn CurrentMetaMode without an explicitly specified display.

# nvidia is able to calculate the dpi correctly
echo "Xft.dpi: $(xdpyinfo | grep "resolution" | sed -e 's/^.*resolution: *//g ; s/x.*$//g')" | xrdb -merge

# applies to individual windows
nvidia-settings --assign ShowVRRVisualIndicator=0
nvidia-settings --assign ShowGraphicsVisualIndicator=0

if [ "${GPU_ROLE}" == "gaming" ]; then
	nvidia-settings --assign CurrentMetaMode="nvidia-auto-select +0+0 {AllowGSYNCCompatible=On}"
else
	# pipeline applies to the whole X server and will mess with games
	nvidia-settings --assign CurrentMetaMode="nvidia-auto-select +0+0 {ForceFullCompositionPipeline=On, AllowGSYNCCompatible=On}"
fi

