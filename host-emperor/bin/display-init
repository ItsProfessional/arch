set -o pipefail

xg32vq_sha="88922ccf7dc7e2cbecb06220d7b4befea30598b35a7b20e13e389dd967585e55  -"
edid_sha=$(xrandr --verbose | grep -A16 "EDID:" | sha256sum)
if [ "$?" -eq 0 ] && [ "${edid_sha}" = "${xg32vq_sha}" ]; then

	# this monitor displays text very poorly so increase DPI and sit further back
	echo "XG32VQ detected"
	xlayoutdisplay --dpi 120
	export DWM_UNDERSCAN_PX=2
else

	# nvidia is able to calculate the dpi correctly
	nvidia_dpi="$(xdpyinfo | grep "resolution" | sed -e 's/^.*resolution: *//g ; s/x.*$//g')"
	echo "using ${nvidia_dpi} DPI calculated by nvidia driver:"
	echo "Xft.dpi: $(xdpyinfo | grep "resolution" | sed -e 's/^.*resolution: *//g ; s/x.*$//g')" | xrdb -merge

	# We use a shell script instead of .nvidia-settings-rc as that method will not assign CurrentMetaMode without an explicitly specified display.

	# applies to individual windows
	# nvidia-settings --assign ShowVRRVisualIndicator=1
	# nvidia-settings --assign ShowGraphicsVisualIndicator=1

	# pipeline applies to the whole X server and will mess with games
	# nvidia-settings --assign CurrentMetaMode="nvidia-auto-select +0+0 {ForceFullCompositionPipeline=On, AllowGSYNCCompatible=On}"
fi

set -o nopipefail
