#!/bin/sh

# Intended for C projects. C++ is included to make sense of C/C++ system headers.
#
# Invoke from a makefile e.g.
# ctags:
#	gentags $(SRC) $(CSRC)

# https://www.topbug.net/blog/2012/03/17/generate-ctags-files-for-c-slash-c-plus-plus-source-files-and-all-of-their-included-header-files/
cc -M "$@" \
	| sed -e 's/[\\ ]/\n/g'  \
	| sed -e '/^$/d' \
	| sed -e '/\.o:[ \t]*$/d' \
	> ctag.filenames
wc -l ctag.filenames

# only a few system headers and project files will be C
OPTS="--languages=C,C++"

# prototypes
OPTS="${OPTS} --c++-kinds=+pl --c-kinds=+pl"

# signatures
OPTS="${OPTS} --fields=+S"

# signatures
OPTS="${OPTS} --extras=+q"

CMD="ctags -L ctag.filenames ${OPTS}"

echo "${CMD}"
${CMD}
