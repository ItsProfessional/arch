#!/bin/sh

# TODO
# BTN_MIDDLE toggle float
# touchpad scroll horizontally
# smart borders

way-displays > /tmp/way-displays.${XDG_VTNR}.${USER}.log 2>&1 &
mako > /tmp/mako.${XDG_VTNR}.${USER}.log 2>&1 &
swayidle -w \
	timeout 900 'swaylock -f -c ${BASE01}' \
	timeout 1800 'sudo systemctl hibernate' \
	before-sleep 'swaylock -f -c ${BASE01}' \
	> /tmp/swayidle.${XDG_VTNR}.${USER}.log 2>&1 &

mod1="Super"
mod2="$mod1+Control"
mod3="$mod2+Shift"

# mouse
riverctl map-pointer normal $mod1 BTN_LEFT move-view
riverctl map-pointer normal $mod1 BTN_RIGHT resize-view

# thumbs
riverctl map normal $mod1 BackSpace focus-output next
riverctl map normal $mod2 BackSpace spawn "riverctl send-to-output next && riverctl focus-output next"
riverctl map normal $mod3 BackSpace send-to-output next
riverctl map normal $mod1 Escape toggle-fullscreen
riverctl map normal $mod2 Escape toggle-float
riverctl map normal $mod1 Tab spawn "bemenu-run > /dev/null 2>&1"
riverctl map normal $mod2 Tab spawn "exec \$(menjar -d ~/.local/share/applications) > /dev/null 2>&1"
riverctl map normal $mod1 Delete spawn "term > /dev/null 2>&1"
riverctl map normal $mod2 Delete spawn "browser > /dev/null 2>&1"
riverctl map normal $mod3 Delete spawn "browser google-chrome-stable > /dev/null 2>&1"
riverctl map normal $mod1 Return focus-view next
riverctl map normal $mod2 Return focus-view previous
riverctl map normal $mod1 Space swap next
riverctl map normal $mod2 Space swap previous

riverctl map normal $mod3 backslash spawn "sudo systemctl hibernate"

# left
tags=1
for k in "a" "o" "e" "u" "i" "semicolon" "comma" "period" "p" "y"; do

	riverctl map normal $mod1 $k set-focused-tags $tags
	riverctl map normal $mod2 $k spawn "riverctl set-view-tags $tags && riverctl set-focused-tags $tags"
	riverctl map normal $mod3 $k set-view-tags $tags
	tags=$(($tags << 1))
done

riverctl map normal $mod1 q close
riverctl map normal $mod3 q exit

riverctl map normal $mod1 equal send-layout-cmd stacktile "primary_ratio 0.5"

#right
riverctl map normal $mod1 plus send-layout-cmd stacktile "primary_ratio +0.05"
riverctl map normal $mod2 plus spawn "\
	riverctl send-layout-cmd stacktile 'primary_sublayout rows' && \
	riverctl send-layout-cmd stacktile 'primary_count +1'\
	"

riverctl map normal $mod1 minus send-layout-cmd stacktile "primary_ratio -0.05"
riverctl map normal $mod2 minus spawn "\
	riverctl send-layout-cmd stacktile 'primary_sublayout rows' && \
	riverctl send-layout-cmd stacktile 'primary_count -1'\
	"

riverctl map normal $mod3 f spawn "volraisemic"

riverctl map normal $mod3 g spawn "volraise"

riverctl map normal $mod3 l spawn "swaylock -f -c \${BASE01} > /dev/null 2>&1"

riverctl map normal $mod3 d spawn "vollowermic"

riverctl map normal $mod1 h spawn "\
	riverctl send-layout-cmd stacktile 'all_primary false' && \
	riverctl send-layout-cmd stacktile 'primary_position left'\
	"

riverctl map normal $mod3 h spawn "vollower"

riverctl map normal $mod1 t spawn "\
	riverctl send-layout-cmd stacktile 'primary_sublayout full' && \
	riverctl send-layout-cmd stacktile 'primary_count 1' && \
	riverctl send-layout-cmd stacktile 'all_primary toggle'\
	"

riverctl map normal $mod1 n spawn "\
	riverctl send-layout-cmd stacktile 'all_primary false' && \
	riverctl send-layout-cmd stacktile 'primary_position right'\
	"

riverctl map normal $mod3 s spawn "sss"

riverctl map normal $mod3 b spawn "volmutemic"

riverctl map normal $mod3 m spawn "volmute"

# special
riverctl map normal None XF86AudioMute         spawn "volmute"
riverctl map normal None XF86AudioMicMute      spawn "volmutemic"
riverctl map normal None XF86AudioRaiseVolume  spawn "volraise"
riverctl map normal None XF86AudioLowerVolume  spawn "vollower"
riverctl map normal None XF86MonBrightnessUp   spawn "sudo brightnessctl s 10%+"
riverctl map normal None XF86MonBrightnessDown spawn "sudo brightnessctl s 10%-"

# appearance
riverctl background-color "0x${BASE00#*#}"
riverctl border-color-unfocused "0x${BASE01#*#}"
riverctl border-color-focused "0x${BASE0203#*#}"
riverctl border-color-urgent "0x${BASE03#*#}"
riverctl border-width 1

# input
riverctl set-repeat 50 400
river-input-setup

# behaviour
riverctl attach-mode bottom
riverctl set-cursor-warp on-output-change

# run
riverctl spawn waybar
riverctl default-layout stacktile
exec stacktile --per-tag-config --drop-empty-configs \
	--primary-position "left" \
	--primary-sublayout "full" --secondary-sublayout "full" --remainder-sublayout "dwindle" \
	--primary-count "1" --secondary-count "1" \
	--primary-ratio "0.5" --secondary-ratio "0.5" \
	--inner-padding "0" --outer-padding "0"

